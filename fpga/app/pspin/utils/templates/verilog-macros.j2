{% macro call_group(group, func, arg) -%}
{%- for sg in groups[group].subgroups -%}
{{ func(arg, sg) }}
{%- endfor %}
{%- endmacro %}

{% macro call_expanded(group, func, arg) -%}
{%- for sg in groups[group].expanded -%}
{{ func(arg, sg) }}
{%- endfor %}
{%- endmacro %}

{%- macro declare_out(sn, sg) %}
    output reg  [{{ sg.signal_width * sg.count - 1}}:0] {{ sn }}_{{ sg.name }}_o,
{%- endmacro %}

{%- macro declare_in(sn, sg) %}
    input wire [{{ sg.signal_width * sg.count - 1}}:0] {{ sn }}_{{ sg.name }}_o,
{%- endmacro %}

{%- macro declare_wire(signal_name, sg) %}
wire [{{ sg.signal_width * sg.count - 1}}:0] {{ signal_name }}_{{ sg.name }};
{%- endmacro %}

{%- macro declare_params() %}
{%- for k, v in params.items() %}
localparam {{ k }} = {{ v }};
{%- endfor %}
{%- endmacro %}

{%- macro declare_store(_, sg) %}
reg [{{ sg.count - 1 }}:0] store_{{ sg.name }} [{{ sg.signal_width - 1 }}:0];
{%- endmacro %}

{%- macro reset_store(_, sg) %}
store_{{ sg.name }}[idx] <= {{ sg.signal_width }}'b0;
{%- endmacro %}

{%- macro update_store(signal_name, sg) %}
store_{{ sg.name }}[idx] <= {{ signal_name }}_{{ sg.name }}[idx];
{%- endmacro %}

{%- macro dump_store(_, sg) %}
$dumpvars(0, store_{{ sg.name }}[idx]);
{%- endmacro %}